/*
 * Copyright 2023 ALFA Project. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

#define MONU_REGS XPAR_ALFAUNIT_0_BASEADDR
#define MONU_REGS_pcReady (MONU_REGS + 0x8C)
#define MONU_REGS_pcSize (MONU_REGS + 0x94)
#define MONU_REGS_filterDist (MONU_REGS + 0xA0)
#define DDR_BASEADDR 0x00
#define POINTCLOUD_MAX_SIZE_DDR 0x100000
#define POINTCLOUD_NUMBER_POINTS 100
#define POINTCLOUD_SIZE_DDR	(POINTCLOUD_NUMBER_POINTS*8)

#include <stdio.h>
#include "platform.h"
#include "xil_printf.h"
#include <sleep.h>

uint64_t mem[1000] = { 3517690087366,
		8186215925699,
		6511270298540,
		7842714419404,
		8306519048393,
		4660090766705,
		7310097187135,
		6369566654648,
		4363798249838,
		2937845974971,
		6695865615706,
		2284969526548,
		7477642330635,
		6429666575974,
		6721698137841,
		1619271878180,
		2718716265595,
		7602166169669,
		6558527063303,
		7958643672737,
		5549169444030,
		5935714731500,
		2113240172042,
		5416023818258,
		4673053197158,
		2559826723535,
		7911428326370,
		8156146108362,
		2104550819531,
		3685112153355,
		5132608798850,
		5098155999622,
		8194846163588,
		4629984118430,
		6644329218794,
		4015801436070,
		3380203881959,
		7838322722619,
		2362341786689,
		6730294231388,
		1954291646905,
		4758892251054,
		4419559883336,
		5012313997652,
		588422907137,
		6240623199990,
		6979397093085,
		2577019504218,
		6863480030508,
		4874842605037,
		1932866159535,
		5544819950717,
		3448940593464,
		3685180702833,
		8096110413739,
		3448981750097,
		5437528474656,
		4595651051570,
		7185609524615,
		3071018206476,
		4428227217223,
		1383036616722,
		2907812593913,
		7116884934996,
		3874144847391,
		8555589207868,
		7318690792584,
		2753119454375,
		8542693098563,
		5536292931476,
		1395877216503,
		2177550845389,
		1280017105669,
		4428142806471,
		5330099765712,
		5828293821014,
		1838248297866,
		7980056576074,
		4209125819823,
		2787525854812,
		1816880152882,
		1881260753549,
		635695989314,
		7486143792149,
		4376608180112,
		7894156771373,
		3908539842613,
		3062404809607,
		5970073225051,
		3139714286487,
		992188171625,
		7271486588212,
		3831182000371,
		6330821510340,
		1735228720870,
		4617169011716,
		5879845684309,
		6536996127808,
		5338773260193,
		923449230701,
		2581395604398,
		8053183218944,
		5321469330373,
		219141506225,
		3410267144691,
		8229236441256,
		4045959333501,
		4947863274542,
		8083232851455,
		7451859550658,
		8237777027527,
		7610779567719,
		3088158819259,
		6777581994472,
		1438900158803,
		8310784196726,
		4960745882383,
		6141932734136,
		1421752272011,
		5729547781983,
		5252824891679,
		8577082197607,
		4105996076294,
		7735354000738,
		5428921436108,
		8250761414112,
		5325859063541,
		7632237625499,
		902065881912,
		777486270829,
		1975692034810,
		3509013906086,
		7426040858538,
		8379587495208,
		2186216866217,
		2589969614289,
		6369448952022,
		5304312596081,
		5828358506384,
		5089565081883,
		1477470586195,
		5523332531529,
		5454631141711,
		4264942044308,
		3027953648432,
		6270703436124,
		3122571511610,
		171823794084,
		3736647434884,
		7181310755583,
		8379535262828,
		4144651895829,
		725908915778,
		1043677512160,
		3199861260343,
		4256409191575,
		5579263771806,
		2478227457664,
		6171996849848,
		3698069537105,
		2018724152882,
		3891302171467,
		94534108158,
		6768931176541,
		3878485165166,
		7782580881228,
		764611789714,
		2521167758238,
		4372352665219,
		7812587259151,
		6519878190218,
		2534043091267,
		4166217892383,
		7602102272361,
		4213486715472,
		1318589760640,
		4273571889183,
		3156907786989,
		3440334079612,
		3667924682611,
		3809750025669,
		1451766710350,
		4157638182096,
		4977976870628,
		4174821852129,
		1086668080515,
		455315097427,
		7924281508818,
		7610801390443,
		2254874345575,
		5738139813260,
		4277849032214,
		3771002454683,
		4617168028154,
		6747406796530,
		3135383144216,
		7765425520906,
		3242749002529,
		1546232530104,
		8555651204913,
		7645044736519,
		5265650549214,
		2869074657627,
		7799706290112,
		2521226019349,
		8495478866703,
		3307251565752,
		5201276109206,
		1550516617362,
		4174747862916,
		7421811032757,
		2181900862189,
		4363799692026,
		6348054659352,
		4320858080807,
		7542003859639,
		7623667090589,
		2486839215997,
		6764684247724,
		7602151948938,
		4990804951114,
		3474712561428,
		5635047097554,
		4565669970958,
		1786772849411,
		330751869745,
		5703761003431,
		7872695436692,
		3448891967110,
		5196916459470,
		4329333655189,
		313660277500,
		1241329108643,
		1735201718705,
		2967893901430,
		4445386637669,
		309257963104,
		3624990081889,
		2985022915421,
		6524095759891,
		4612916576984,
		8572798632312,
		5652215695002,
		2667291673455,
		5171246728975,
		3431775666342,
		5557691876694,
		7262888265491,
		2534066030254,
		6451061589247,
		1816823202302,
		2645706933226,
		279278256648,
		1468967028501,
		133178917611,
		2431021090557,
		8143280998215,
		2448133981724,
		360850851492,
		7520503988832,
		4737435108024,
		7657945760475,
		2538340877397,
		4617212068820,
		1271345579881,
		5716646953687,
		8469741045303,
		3324366160549,
		6893524878709,
		4960742015241,
		7254318319512,
		7460410885788,
		1855511265902,
		5025172489182,
		1610675323783,
		627160581406,
		4037395743433,
		8370971803974,
		1301419852169,
		5321560686959,
		6369563116909,
		695831167708,
		2817542063878,
		7962871268831,
		4711676970210,
		8396691276947,
		1859850142997,
		3216964583442,
		2439628784725,
		1919980143935,
		5772534939925,
		1859723919594,
		1305717638110,
		6854776193570,
		5003722491457,
		2242098497034,
		5291487135263,
		6837714158406,
		5501935223180,
		2379448254890,
		828986820471,
		3964362620989,
		8001623360302,
		3247022409003,
		541241640295,
		7056729571392,
		846183990798,
		3354377586355,
		790341551035,
		6846277420510,
		4333741867547,
		5892741333543,
		5218401911395,
		2714485522779,
		4561283186880,
		7297181287378,
		5274287474118,
		1765272388459,
		1043798557450,
		2680081614665,
		1915667220319,
		4372358432071,
		4033059161143,
		6107529610410,
		7834100893024,
		7331598239363,
		3122518294946,
		1310056646146,
		2422432530689,
		2602859823869,
		2375222363247,
		4501249786877,
		1185515046725,
		3809759265971,
		3560601289540,
		6850589427485,
		3307230396911,
		3530558014185,
		6940761327171,
		803175466493,
		150405382978,
		6150442583239,
		7846950535955,
		4101819531905,
		6128918331405,
		1619313426859,
		4634317162041,
		2413892076403,
		7889926554228,
		3307215783396,
		8224943112381,
		6721674609991,
		674418197768,
		7065299059282,
		5278644961396,
		3865501761579,
		794596016389,
		7189830566610,
		7670882107714,
		7593556705390,
		5909903704199,
		3058130289346,
		1108115260941,
		5574941345308,
		519742096991,
		1997183845452,
		4363693851154,
		3693789447295,
		3921405019186,
		7181249282616,
		1185431029385,
		6515473777079,
		352187844560,
		5025196934798,
		8426824271204,
		2087411189543,
		2680136730329,
		8499815581183,
		1842592482638,
		330814325779,
		6996575322521,
		3431766623942,
		8121826935785,
		468211074787,
		8504165401323,
		1593476908813,
		390900483755,
		816132719104,
		3285667217918,
		4110412613356,
		4114677891629,
		6421075985901,
		3255665754616,
		2847679907057,
		2881935770943,
		820406124955,
		8392448410959,
		1357241516267,
		5321555640868,
		4883450693340,
		2233493554015,
		7039542428249,
		6446811776253,
		6880569459851,
		6034466604926,
		7460439459150,
		5519092745592,
		897703478948,
		4140359417997,
		975037728515,
		1138239407812,
		7344524362838,
		4857626363658,
		2349450331009,
		1395983320037,
		5991481280137,
		2139010958599,
		3474692899431,
		3332978705324,
		4819049514906,
		5918542922031,
		4496945972735,
		4548438590118,
		6648668685993,
		2031628060197,
		2121770926419,
		5055212422470,
		7297223099689,
		7069576201921,
		485374165686,
		1026589263466,
		2044416753922,
		240539862171,
		6743215114045,
		5029457560046,
		3448938299534,
		7868426290627,
		4131765551617,
		3345787060705,
		2293612283357,
		2190505017465,
		3315720324263,
		5884149892383,
		2254987919716,
		7675120846589,
		6292177093331,
		8521215902871,
		4780339626865,
		1400251745748,
		1026614231138,
		6360947098371,
		7769713935197,
		5274339705316,
		7086782218763,
		1881273795887,
		7438884669146,
		1713702568806,
		6549874016814,
		7877089494175,
		1245575054570,
		7073818019238,
		1297187536922,
		7125456717747,
		7005112500308,
		6717438034050,
		1413044438432,
		7683758686372,
		2770378491715,
		5841161683419,
		7554873885746,
		8525522141323,
		1451786829998,
		3393091600556,
		6485507048075,
		6502613713006,
		8224985843364,
		502632154234,
		712968111906,
		1198329038412,
		5244260516045,
		1086749672737,
		4067340124454,
		7065228739128,
		4840525792994,
		7456093112049,
		1086660608389,
		1803889673768,
		871953007951,
		4045908083423,
		1834062841739,
		3899898200523,
		2310705119510,
		3551945098789,
		2813265642197,
		5927170474355,
		5381658312846,
		6013017981841,
		7353087164985,
		5961499674282,
		7048049067243,
		2014391829213,
		4325067326795,
		1353045771235,
		2620027699590,
		4411030898333,
		1284235985563,
		6631516472566,
		7782584747108,
		4458292053149,
		1791055299037,
		5196955910823,
		6597098145429,
		4608559154235,
		3406016349490,
		8388201416233,
		6356576763904,
		2160428188294,
		2048808124866,
		4200597094572,
		3736691803495,
		7181188990514,
		979312837004,
		2177556938896,
		5338722337739,
		3066641515230,
		678662243787,
		7537769252549,
		4436703445378,
		4252124840711,
		7542074770353,
		7855519499971,
		3101052831203,
		3427439019744,
		927781619056,
		6953652455331,
		3152522380310,
		3436005622809,
		4557064700239,
		5025160103583,
		2478247248889,
		6236304443228,
		7941525472792,
		1443140863860,
		1284306371738,
		1546215489708,
		6592824082586,
		7271444120568,
		6494121361678,
		8521234253223,
		1829710792410,
		2813229336161,
		2031537881832,
		4209154393410,
		5909879259437,
		2847677154414,
		687298709425,
		6004480016579,
		3577753241105,
		6902051635573,
		7713876215195,
		5553516839064,
		6013003564564,
		8448265945302,
		4909260604845,
		4075974034158,
		6232045519613,
		2684416624534,
		4879113126982,
		8589962183101,
		3363063399912,
		4505426198981,
		4526939833597,
		2254975730255,
		309281358662,
		4432450945392,
		2147544596697,
		6730273392054,
		3371670111947,
		4853327856825,
		7013809979885,
		2620055487304,
		5188434986216,
		5377401357164,
		7254296756883,
		4707293201105,
		5411672753872,
		2877732421662,
		4780381374413,
		2869060764280,
		6519838475863,
		8250665600923,
		5716650951748,
		3448897930513,
		3981503497317,
		17252812648,
		6953614378831,
		7967218270407,
		1288501133733,
		1335751606750,
		764568207573,
		1700830970393,
		7563526997675,
		2435251242539,
		1894192775505,
		6352372302076,
		5317233673642,
		6932135610221,
		7971533095234,
		5536316196327,
		3028045201910,
		4496905077892,
		854754198509,
		8117498676459,
		7945808185021,
		5226991452985,
		8478299063865,
		7713785053629,
		970703962880,
		2783200412671,
		6592814188381,
		4071659340972,
		6846193141166,
		5884172437042,
		4698695271452,
		7099602174995,
		6816116376272,
		734530307264,
		7645110076866,
		3556320019391,
		5772445549231,
		7743836849976,
		4411023950865,
		7889952834242,
		167540557405,
		7980060509060,
		137505473917,
		4471096018732,
		6171868267413,
		5102446445180,
		3994350125761,
		116003701529,
		519786070471,
		7816843494732,
		5411765617363,
		2950671303607,
		128896271414,
		1791004377397,
		6824815297166,
		3375975170828,
		335010202736,
		7005095854501,
		2186170271625,
		6451104776677,
		1073848386740,
		1348637230234,
		5437459071584,
		1894087656667,
		7194139625302,
		7421803300550,
		6850552399245,
		34380514025,
		5450422683296,
		2757488476623,
		4548459299712,
		2027260936725,
		5922763374682,
		3990094611530,
		7537716298511,
		6695863584131,
		2065989304844,
		1082444612697,
		150421308669,
		1808187852004,
		3801068929284,
		7992942528362,
		4711595508901,
		6708791215885,
		8031607260169,
		8014481852130,
		2615708616457,
		2950642597989,
		5755305591139,
		4514017903782,
		2452466369393,
		5772501517379,
		3663672772105,
		2194749589022,
		7224208457865,
		519791249079,
		2353735599138,
		6249239676640,
		2658618902060,
		34377761001,
		8267837014866,
		558367442353,
		5123923182222,
		2199128180325,
		5458982536642,
		85952365535,
		4831861801702,
		5720929862933,
		3341496485387,
		7756767428911,
		3818341140403,
		4200564654114,
		472536383660,
		3947186357926,
		5557700068429,
		5132541363657,
		7718098306596,
		6382428356838,
		5540570727109,
		6743179985811,
		373739750669,
		5351625328265,
		6756037623906,
		635712374655,
		532611466081,
		4608514262674,
		1340072592186,
		6730288072239,
		2147545515557,
		6515552814087,
		7791161966665,
		8151864116955,
		5867010195508,
		6713106957132,
		2735997452987,
		2950734808270,
		7189781414818,
		2851906782549,
		7958624468998,
		2538399531495,
		1769613230740,
		5227062689969,
		7589300995391,
		6747486487448,
		1876996589149,
		6120416937649,
		3990099853760,
		2379429576919,
		5678017347884,
		180409992709,
		6116089988417,
		5102468728695,
		5368760763996,
		2400891963232,
		481147093473,
		330730898514,
		1073859068809,
		6047413241367,
		8109003310369,
		6150504318560,
		1696590267274,
		4681638019491,
		3586428108847,
		2826121183803,
		7469055673201,
		7348803600849,
		3358689395249,
		5970045961681,
		7675137885478,
		1099541054388,
		4114609209689,
		4179014844419,
		3839730581749,
		5897107605065,
		7950012843644,
		4479685953019,
		1262818690853,
		6867761759912,
		1395880690443,
		7765378598452,
		1980033205303,
		4118931048004,
		5201255465578,
		7391653528068,
		2791820165132,
		1254140478118,
		2808928142718,
		1086715463099,
		3268471095346,
		2585573196889,
		498308875038,
		5854128899698,
		2147500426687,
		94499899329,
		214775432420,
		841863922324,
		5600664027533,
		2396659254286,
		1357245186064,
		1344345015930,
		1249948074895,
		3710872519637,
		6223443658026,
		3899911963153,
		2044425011614,
		4170458268813,
		6837693974072,
		1816809703211,
		4312195596967,
		6747443692551,
		6902049473930,
		399559229646,
		704504071395,
		1408817627234,
		4028761178705,
		5102459290974,
		5342968021596,
		121702086,
		5162667934149,
		6189088572871,
		5918499340411,
		7121067312082,
		6871992042027,
		429598179995,
		8413867475642,
		3698071897447,
		5042404196910,
		3861223179268,
		8315129235270,
		2950746736000,
		2899134776649,
		3886977974692,
		4745971761299,
		2959360198451,
		3088191718287,
		330791715718,
		4806139183796,
		5669359583357,
		4114629198371,
		7348783088427,
		6648730092443,
		3968594739616,
		7275682334478,
		5158339348413,
		803269968684,
		8237838370448,
		1121086539085,
		3736635442154,
		326529058101,
		5231386165686,
		6287923282702,
		8401042931904,
		7022305478172,
		30164582791,
		4780341921296,
		6485456390013,
		2727351091688,
		5596361261850,
		1889804878677,
		2727367345833,
		5514863707827,
		3934241423774,
		1657912231509,
		1679363146558,
		8139082303095,
		7911333758793,
		8113309483612,
		1241292997796,
		1842670207762,
		4097460339105,
		6047437030039,
		871973127155,
		1370156893010,
		5020930672221,
		1133919340294,
		4625746036636,
		7597914522649,
		1516180146059,
		1662245339881,
		4093139158397,
		3637838218155,
		6884856825572,
		3534845839034,
		5123901425127,
		5862719554621,
		390854738996,
		6064607397229,
		2173285369044,
		6150486361948,
		30078402869,
		8229267833077,
		4737457259032,
		8014478508039,
		756034306502,
		5673694922058,
		6150493112012,
		7189806121004,
		1271390602604,
		2284955436013,
		5248472581142,
		1331469943140,
		8108905596605,
		6365262447750,
		5669481939540,
		1580603672456,
		1181208936996,
		5467517092656,
		4720241346212,
		5411775513334,
		575569855061,
		7494848283766,
		6601473197518,
		3775376523349,
		7413149074092,
		2263448813710,
		4917749415965,
		8001652131385,
		2662908102009,
		1185413136957,
		2765978075513,
		2134618735801,
		816113582830,
		8366695580304,
		7546366788713,
		1292830311666,
		8534230762693,
		3882761585074,
		455356317869,
		5682339971431,
		4771722559514,
		652930908229,
		7713779353333,
		4110368375796,
		5179836466711,
		1687930668578,
		7554973697372,
		2323658245882,
		4582754353454,
		4226329674778,
		2547008734773,
		7941456070566,
		1318584256025,
		159037523787,
		8405303165733,
		6481177150753,
		2972135982483,
		51597476072,
		5218449294536,
		7911403749717,
		3199839766461,
		2620039955421,
		2967938467480,
		4041668757396,
		4823352738599,
		3427468969654,
		1881212519823,
		6730307929749,
		6300847114065,
		6464004162896,
		4788955645096,
		5184062621340,
		7816881897845,
		8285076980398,
		4393753577097,
		5252760995086,
		8117541995329,
		3985851352790,
		352290079759,
		880596682653,
		2070265071094,
		1683672270710,
		5695255414082,
		7786791174573,
		1864120075070,
		4492593398417,
		545578615250,
		2108931966585,
		6979416490740,
		3049537863729,
		5579179164460,
		6738893931795,
		1520459513859,
		4063069603651,
		8100314088059,
		2345096446724,
		6008682252108,
		5845552595388,
		7636520534466,
		2465332200910,
		3139662316852,
		4776035221553,
		3500453396962,
		5407494570566,
		841875194136,
		859061552965,
		4277882128146,
		425311142921,
		5222681019227,
		6300752807329,
		2375122617908,
		6807541056280,
		8005914657188,
		7241397764383,
		7490496364666,
		5008042426449,
		571310147234,
		5617914347933,
};

int main()
{
    init_platform();
    uint64_t * ptr = DDR_BASEADDR;
    ulong x,y,z, label, read_data, inside_i = 0;
    memcpy(ptr,mem, POINTCLOUD_SIZE_DDR);
    ptr = MONU_REGS_pcSize;
    *ptr = 100;
    ptr = MONU_REGS_filterDist;
    * ptr = 1000;
    usleep(10);
    ptr = MONU_REGS_pcReady;
    * ptr = 0;
    ptr = MONU_REGS_pcReady;
    * ptr = 1;
    while(*ptr==0);
    ptr = DDR_BASEADDR;
   for(int i=0; i<POINTCLOUD_SIZE_DDR; i++)
   {
	   read_data = *ptr;
	   x = (read_data & 0x000000000000FFFF);
	   y = ((read_data & 0x00000000FFFF0000) >> 16);
	   z = ((read_data & 0x0000FFFF00000000) >> 32);
	   label = (read_data >> 56) & 0xFF;

	   if(label==1){
		   printf("Inside point: %l", read_data);
		   printf("-> X %l",x);
		   printf("-> Y %l",y);
		   printf("-> Z %l",z);
		   printf("-> label %l",label);
		   printf("-> id %l",i);
		 inside_i= inside_i +1;
	   }
   }
    printf("Points inside: %l", inside_i);
    cleanup_platform();
    return 0;
}
